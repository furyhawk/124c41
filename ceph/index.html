
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="programming, machine learning, software architecture, and more">
      
      
        <meta name="author" content="furyhawk">
      
      
      
        <link rel="prev" href="../k8s/">
      
      
        <link rel="next" href="../macos/">
      
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>ceph - 124c41</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#manual-install-of-a-ceph-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="124c41" class="md-header__button md-logo" aria-label="124c41" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            124c41
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ceph
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="124c41" class="md-nav__button md-logo" aria-label="124c41" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    124c41
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../resume/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resume
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../uv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    uv
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../venv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    venv
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../poetry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    poetry
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../conda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conda
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    git
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ssh
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../softwarearchitecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    softwarearchitecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vscode
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../machine_learning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    machine_learning
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../llm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    llm
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../embedding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    embedding
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../llama2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    llmama2
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ollama/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ollama
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rag
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../framework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Framework
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../db/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    database
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataframe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dataframe
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../chart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../anomaly_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    anomaly_detection
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hydra
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ubuntu
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../k8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ceph
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ceph
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#daemon-container" class="md-nav__link">
    <span class="md-ellipsis">
      Daemon container
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selinux" class="md-nav__link">
    <span class="md-ellipsis">
      SELinux
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kv-backends" class="md-nav__link">
    <span class="md-ellipsis">
      KV backends
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#populate-key-value-store" class="md-nav__link">
    <span class="md-ellipsis">
      Populate Key Value store
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zap-a-device" class="md-nav__link">
    <span class="md-ellipsis">
      Zap a device
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-monitor" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a monitor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-manager-daemon" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a Manager daemon
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-an-osd" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy an OSD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploy an OSD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#without-osd_type" class="md-nav__link">
    <span class="md-ellipsis">
      Without OSD_TYPE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ceph-disk" class="md-nav__link">
    <span class="md-ellipsis">
      Ceph disk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ceph-disk-activate" class="md-nav__link">
    <span class="md-ellipsis">
      Ceph disk activate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ceph-osd-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Ceph OSD directory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ceph OSD directory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multiple-osds" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple OSDs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ceph-osd-directory-single" class="md-nav__link">
    <span class="md-ellipsis">
      Ceph OSD directory single
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ceph OSD directory single">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#btrfs-and-journal" class="md-nav__link">
    <span class="md-ellipsis">
      BTRFS and journal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-mds" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a MDS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-rados-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a Rados Gateway
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a REST API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-rbd-mirror" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a RBD mirror
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploy a RBD mirror">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetching-software" class="md-nav__link">
    <span class="md-ellipsis">
      Fetching software.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-node-1" class="md-nav__link">
    <span class="md-ellipsis">
      Configure node 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-more-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up more nodes.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Adding storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Post configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../macos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macos
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sway
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../mqtt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mqtt
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../jetson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jetson
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../yolox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    yolox
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gpt
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../stable_diffusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    stable_diffussion
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../wandb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model Analysis
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../smb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Samba
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../smb2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Samba_ubuntu
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../mypy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../literatures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Literatures
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../scrape_pad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    scrape_pad
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../nes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../time_travel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    time_travel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../random/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    random
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#daemon-container" class="md-nav__link">
    <span class="md-ellipsis">
      Daemon container
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selinux" class="md-nav__link">
    <span class="md-ellipsis">
      SELinux
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kv-backends" class="md-nav__link">
    <span class="md-ellipsis">
      KV backends
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#populate-key-value-store" class="md-nav__link">
    <span class="md-ellipsis">
      Populate Key Value store
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zap-a-device" class="md-nav__link">
    <span class="md-ellipsis">
      Zap a device
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-monitor" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a monitor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-manager-daemon" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a Manager daemon
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-an-osd" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy an OSD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploy an OSD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#without-osd_type" class="md-nav__link">
    <span class="md-ellipsis">
      Without OSD_TYPE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ceph-disk" class="md-nav__link">
    <span class="md-ellipsis">
      Ceph disk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ceph-disk-activate" class="md-nav__link">
    <span class="md-ellipsis">
      Ceph disk activate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ceph-osd-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Ceph OSD directory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ceph OSD directory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multiple-osds" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple OSDs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ceph-osd-directory-single" class="md-nav__link">
    <span class="md-ellipsis">
      Ceph OSD directory single
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ceph OSD directory single">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#btrfs-and-journal" class="md-nav__link">
    <span class="md-ellipsis">
      BTRFS and journal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-mds" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a MDS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-rados-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a Rados Gateway
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a REST API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-a-rbd-mirror" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a RBD mirror
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploy a RBD mirror">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetching-software" class="md-nav__link">
    <span class="md-ellipsis">
      Fetching software.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-node-1" class="md-nav__link">
    <span class="md-ellipsis">
      Configure node 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-more-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up more nodes.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Adding storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Post configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="manual-install-of-a-ceph-cluster">Manual install of a Ceph Cluster.</h1>
<h2 id="daemon-container">Daemon container</h2>
<p>This Dockerfile may be used to bootstrap a Ceph cluster with all the Ceph daemons running. To run a certain type of daemon, simply use the name of the daemon as <code>$1</code>. Valid values are:</p>
<ul>
<li><code>mon</code> deploys a Ceph monitor</li>
<li><code>osd</code> deploys an OSD using the method specified by <code>OSD_TYPE</code></li>
<li><code>osd_directory</code> deploys <strong>one or multiple OSDs in a single container</strong> using a prepared directory (used in scenario where the operator doesn't want to use <code>--privileged=true</code>)</li>
<li><code>osd_directory_single</code> deploys an <strong>single OSD per container</strong> using a prepared directory (used in scenario where the operator doesn't want to use <code>--privileged=true</code>)</li>
<li><code>osd_ceph_disk</code> deploys an OSD using ceph-disk, so you have to provide a whole device (ie: /dev/sdb)</li>
<li><code>mds</code> deploys a MDS</li>
<li><code>rgw</code> deploys a Rados Gateway</li>
</ul>
<h2 id="usage">Usage</h2>
<p>You can use this container to bootstrap any Ceph daemon.</p>
<ul>
<li><code>CLUSTER</code> is the name of the cluster (DEFAULT: ceph)</li>
</ul>
<h2 id="selinux">SELinux</h2>
<p>If SELinux is enabled, run the following commands:</p>
<pre><code>sudo chcon -Rt svirt_sandbox_file_t /etc/ceph
sudo chcon -Rt svirt_sandbox_file_t /var/lib/ceph
</code></pre>
<h2 id="kv-backends">KV backends</h2>
<p>We currently support one KV backend to store our configuration flags, keys and maps: etcd.</p>
<p>There is a <code>ceph.defaults</code> config file in the image that is used for defaults to bootstrap daemons. It will add the keys if they are not already present. You can either pre-populate the KV store with your own settings, or provide a ceph.defaults config file. To supply your own defaults, make sure to mount the /etc/ceph/ volume and place your ceph.defaults file there.</p>
<p>Important variables in <code>ceph.defaults</code> to add/change when you bootstrap an OSD:</p>
<ul>
<li><code>/osd/osd_journal_size</code></li>
<li><code>/osd/cluster_network</code></li>
<li><code>/osd/public_network</code></li>
</ul>
<p>Note: <code>cluster_network</code> and <code>public_network</code> are currently not populated in the defaults, but can be passed as environment variables with <code>-e CEPH_PUBLIC_NETWORK=...</code> for more flexibility</p>
<h2 id="populate-key-value-store">Populate Key Value store</h2>
<pre><code>docker run -d --net=host \
-e KV_TYPE=etcd \
-e KV_IP=127.0.0.1 \
-e KV_PORT=2379 \
ceph/daemon populate_kvstore
</code></pre>
<h2 id="zap-a-device">Zap a device</h2>
<p>Sometimes you might want to destroy partition tables from a disk. For this you can use the <code>zap_device</code> scenario that works as follow:</p>
<pre><code>docker run -d --privileged=true \
-v /dev/:/dev/ \
-e OSD_DEVICE=/dev/sdd \
ceph/daemon zap_device
</code></pre>
<h2 id="deploy-a-monitor">Deploy a monitor</h2>
<p>A monitor requires some persistent storage for the docker container. If a KV store is used, <code>/etc/ceph</code> will be auto-generated from data kept in the KV store. <code>/var/lib/ceph</code>, however, <em>must</em> be provided by a docker volume. The ceph mon will periodically store data into <code>/var/lib/ceph</code>, including the latest copy of the CRUSH map. If a mon restarts, it will attempt to download the latest monmap and CRUSH map from other peer monitors. However, if all mon daemons have gone down, monitors must be able to recover their previous maps. The docker volume used for <code>/var/lib/ceph</code> should be backed by some durable storage, and must be able to survive container and node restarts.</p>
<p>Without KV store, run:</p>
<pre><code>docker run -d --net=host \
-v /etc/ceph:/etc/ceph \
-v /var/lib/ceph/:/var/lib/ceph/ \
-e MON_IP=192.168.0.20 \
-e CEPH_PUBLIC_NETWORK=192.168.0.0/24 \
ceph/daemon mon
</code></pre>
<p>With KV store, run:</p>
<pre><code>docker run -d --net=host \
-v /var/lib/ceph:/var/lib/ceph \
-e MON_IP=192.168.0.20 \
-e CEPH_PUBLIC_NETWORK=192.168.0.0/24 \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
ceph/daemon mon
</code></pre>
<p>List of available options:</p>
<ul>
<li><code>MON_NAME</code>: name of the monitor (default to hostname)</li>
<li><code>CEPH_PUBLIC_NETWORK</code>: CIDR of the host running Docker, it should be in the same network as the <code>MON_IP</code></li>
<li><code>CEPH_CLUSTER_NETWORK</code>: CIDR of a secondary interface of the host running Docker. Used for the OSD replication traffic</li>
<li><code>MON_IP</code>: IP address of the host running Docker</li>
<li><code>NETWORK_AUTO_DETECT</code>: Whether and how to attempt IP and network autodetection. Meant to be used without <code>--net=host</code>.</li>
<li>
<p><code>NEW_USER_KEYRING</code>: if specified, it will be imported to keyrings. Works in demo mode only.</p>
</li>
<li>
<p>0 = Do not detect (default)</p>
</li>
<li>1 = Detect IPv6, fallback to IPv4 (if no globally-routable IPv6 address detected)</li>
<li>4 = Detect IPv4 only</li>
<li>6 = Detect IPv6 only</li>
</ul>
<h2 id="deploy-a-manager-daemon">Deploy a Manager daemon</h2>
<p>Since luminous, a manager daemon is mandatory, see <a href="https://docs.ceph.com/en/latest/mgr/">docs</a></p>
<p>Without KV store, run:</p>
<pre><code>docker run -d --net=host \
-v /etc/ceph:/etc/ceph \
-v /var/lib/ceph/:/var/lib/ceph/ \
ceph/daemon mgr
</code></pre>
<p>With KV store, run:</p>
<pre><code>docker run -d --net=host \
-v /var/lib/ceph:/var/lib/ceph \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
ceph/daemon mgr
</code></pre>
<h2 id="deploy-an-osd">Deploy an OSD</h2>
<p>There are four available <code>OSD_TYPE</code> values:</p>
<ul>
<li><code>&lt;none&gt;</code> - if no <code>OSD_TYPE</code> is set; one of <code>disk</code>, <code>activate</code> or <code>directory</code> will be used based on autodetection of the current OSD bootstrap state</li>
<li><code>activate</code> - the daemon expects to be passed a block device of a <code>ceph-disk</code>-prepared disk (via the <code>OSD_DEVICE</code> environment variable); no bootstrapping will be performed</li>
<li><code>directory</code> - the daemon expects to find the OSD filesystem(s) already mounted in <code>/var/lib/ceph/osd/</code></li>
<li><code>disk</code> - the daemon expects to be passed a block device via the <code>OSD_DEVICE</code> environment variable</li>
<li><code>prepare</code> - the daemon expects to be passed a block device and run <code>ceph-disk</code> prepare to bootstrap the disk (via the <code>OSD_DEVICE</code> environment variable)</li>
</ul>
<p>Options for OSDs (TODO: consolidate these options between the types):</p>
<ul>
<li><code>JOURNAL_DIR</code> - if provided, new OSDs will be bootstrapped to use the specified directory as a common journal area. This is usually used to store the journals for more than one OSD on a common, separate disk. This currently only applies to the <code>directory</code> OSD type.</li>
<li><code>JOURNAL</code> - if provided, the new OSD will be bootstrapped to use the specified journal file (if you do not wish to use the default). This is currently only supported by the <code>directory</code> OSD type</li>
<li><code>OSD_DEVICE</code> - mandatory for <code>activate</code> and <code>disk</code> OSD types; this specifies which block device to use as the OSD</li>
<li><code>OSD_JOURNAL</code> - optional override of the OSD journal file. this only applies to the <code>activate</code> and <code>disk</code> OSD types</li>
<li><code>OSD_FORCE_EXT4</code> - in case the osd data on ext4 is not automatically recognized (i.e. hidden by overlayfs) you can force them by settings this to <code>yes</code>.</li>
</ul>
<h3 id="without-osd_type">Without OSD_TYPE</h3>
<p>If the operator does not specify an <code>OSD_TYPE</code> autodetection happens:</p>
<ul>
<li><code>disk</code> is used if no bootstrapped OSD is found.</li>
<li><code>activate</code> is used if a bootstrapped OSD is found and <code>OSD_DEVICE</code> is also provided.</li>
<li><code>directory</code> is used if a bootstrapped OSD is found and no <code>OSD_DEVICE</code> is provided.</li>
</ul>
<p>Without KV backend:</p>
<pre><code>docker run -d --net=host \
--pid=host \
--privileged=true \
-v /etc/ceph:/etc/ceph \
-v /var/lib/ceph/:/var/lib/ceph/ \
-v /dev/:/dev/ \
-v /run/udev/:/run/udev/ \
-e OSD_DEVICE=/dev/vdd \
ceph/daemon osd
</code></pre>
<p>With KV backend:</p>
<pre><code>docker run -d --net=host \
--privileged=true \
--pid=host \
-v /dev/:/dev/ \
-v /run/udev/:/run/udev/ \
-e OSD_DEVICE=/dev/vdd \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
ceph/daemon osd
</code></pre>
<h3 id="ceph-disk">Ceph disk</h3>
<p>Without KV backend:</p>
<pre><code>docker run -d --net=host \
--privileged=true \
--pid=host \
-v /etc/ceph:/etc/ceph \
-v /var/lib/ceph/:/var/lib/ceph/ \
-v /dev/:/dev/ \
-v /run/udev/:/run/udev/ \
-e OSD_DEVICE=/dev/vdd \
-e OSD_TYPE=disk \
ceph/daemon osd
</code></pre>
<p>Using bluestore:</p>
<pre><code>docker run -d --net=host \
--privileged=true \
--pid=host \
-v /etc/ceph:/etc/ceph \
-v /var/lib/ceph/:/var/lib/ceph/ \
-v /dev/:/dev/ \
-v /run/udev/:/run/udev/ \
-e OSD_DEVICE=/dev/vdd \
-e OSD_TYPE=disk \
-e OSD_BLUESTORE=1 \
ceph/daemon osd
</code></pre>
<p>Using dmcrypt:</p>
<pre><code>docker run -d --net=host \
--privileged=true \
--pid=host \
-v /etc/ceph:/etc/ceph \
-v /var/lib/ceph/:/var/lib/ceph/ \
-v /dev/:/dev/ \
-v /run/udev/:/run/udev/ \
-e OSD_DEVICE=/dev/vdd \
-e OSD_TYPE=disk \
-e OSD_DMCRYPT=1 \
ceph/daemon osd
</code></pre>
<p>With KV backend:</p>
<pre><code>docker run -d --net=host \
--privileged=true \
--pid=host \
-v /dev/:/dev/ \
-v /run/udev/:/run/udev/ \
-e OSD_DEVICE=/dev/vdd \
-e OSD_TYPE=disk \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
ceph/daemon osd
</code></pre>
<p>Using bluestore with KV backend:</p>
<pre><code>docker run -d --net=host \
--privileged=true \
--pid=host \
-v /dev/:/dev/ \
-v /run/udev/:/run/udev/ \
-e OSD_DEVICE=/dev/vdd \
-e OSD_TYPE=disk \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
-e OSD_BLUESTORE=1 \
ceph/daemon osd
</code></pre>
<p>Using dmcrypt with KV backend:</p>
<pre><code>docker run -d --net=host \
--privileged=true \
--pid=host \
-v /dev/:/dev/ \
-v /run/udev/:/run/udev/ \
-e OSD_DEVICE=/dev/vdd \
-e OSD_TYPE=disk \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
-e OSD_DMCRYPT=1 \
ceph/daemon osd
</code></pre>
<p>List of available options:</p>
<ul>
<li><code>OSD_DEVICE</code> is the OSD device</li>
<li><code>OSD_JOURNAL</code> is the journal for a given OSD</li>
<li><code>HOSTNAME</code> is used to place the OSD in the CRUSH map</li>
</ul>
<p>If you do not want to use <code>--privileged=true</code>, please fall back on the second example.</p>
<h3 id="ceph-disk-activate">Ceph disk activate</h3>
<p>This function is balance between ceph-disk and osd directory where the operator can use ceph-disk outside of the container (directly on the host) to prepare the devices. Devices will be prepared with <code>ceph-disk prepare</code>, then they will get activated inside the container. A priviledged container is still required as ceph-disk needs to access /dev/. So this has minimum value compare to the ceph-disk but might fit some use cases where the operators want to prepare their devices outside of a container.</p>
<pre><code>docker run -d --net=host \
--privileged=true \
--pid=host \
-v /etc/ceph:/etc/ceph \
-v /var/lib/ceph/:/var/lib/ceph/ \
-v /dev/:/dev/ \
-v /run/udev/:/run/udev/ \
-e OSD_DEVICE=/dev/vdd \
-e OSD_TYPE=activate \
ceph/daemon osd
</code></pre>
<h3 id="ceph-osd-directory">Ceph OSD directory</h3>
<p>There are a number of environment variables which are used to configure the execution of the OSD:</p>
<ul>
<li><code>CLUSTER</code> is the name of the ceph cluster (defaults to <code>ceph</code>)</li>
</ul>
<p>If the OSD is not already created (key, configuration, OSD data), the following environment variables will control its creation:</p>
<ul>
<li><code>WEIGHT</code> is the of the OSD when it is added to the CRUSH map (default is <code>1.0</code>)</li>
<li><code>JOURNAL</code> is the location of the journal (default is the <code>journal</code> file inside the OSD data directory)</li>
<li><code>HOSTNAME</code> is the name of the host; it is used as a flag when adding the OSD to the CRUSH map</li>
</ul>
<p>The old option <code>OSD_ID</code> is now unused. Instead, the script will scan for each directory in <code>/var/lib/ceph/osd</code> of the form <code>&lt;cluster&gt;-&lt;osd_id&gt;</code>.</p>
<p>To create your OSDs simply run the following command:</p>
<p><code>docker exec &lt;mon-container-id&gt; ceph osd create</code>.</p>
<p>Note that we now default to dropping root privileges, so it is important to set the proper ownership for your OSD directories. The Ceph OSD runs as UID:167, GID:167, so:</p>
<p><code>chown -R 167:167 /var/lib/ceph/osd/</code></p>
<h4 id="multiple-osds">Multiple OSDs</h4>
<p>There is a problem when attempting run run multiple OSD containers on a single docker host. See issue #19.</p>
<p>There are two workarounds, at present:</p>
<ul>
<li>Run each OSD with the <code>--pid=host</code> option</li>
<li>Run multiple OSDs within the same container</li>
</ul>
<p>To run multiple OSDs within the same container, simply bind-mount each OSD datastore directory:</p>
<ul>
<li><code>docker run -v /osds/1:/var/lib/ceph/osd/ceph-1 -v /osds/2:/var/lib/ceph/osd/ceph-2</code></li>
</ul>
<h3 id="ceph-osd-directory-single">Ceph OSD directory single</h3>
<p>Ceph OSD directory single has a similar design to Ceph OSD directory since they both aim to run OSD processes from an already bootstrapped directory. So we assume the OSD directory has been populated already. The major different is that Ceph OSD directory single has a much simpler implementation since it only runs a single OSD process per container. It doesn't do anything with the journal as it assumes journal's symlink was provided during the initialization sequence of the OSD.</p>
<p>This scenario goes through the OSD directory (<code>/var/lib/ceph/osd</code>) and looks for OSDs that don't have a lock held by any other OSD. If no lock is found, the OSD process starts. If all the OSDs are already running, we gently exit 0 and explain that all the OSDs are already running.</p>
<p><strong>Important note</strong>: if you are aiming at running multiple OSD containers on a same machine (things that you will likely do with Ceph anyway), you must enable <code>--pid=host</code>. However if you are running Docker 1.12 (based on <a href="https://github.com/docker/docker/pull/22481">https://github.com/docker/docker/pull/22481</a>), you can just share the same PID namespace for the OSD containers only using: <code>--pid=container:&lt;id&gt;</code>.</p>
<h4 id="btrfs-and-journal">BTRFS and journal</h4>
<p>If your OSD is BTRFS and you want to use PARALLEL journal mode, you will need to run this container with <code>--privileged</code> set to true. Otherwise, <code>ceph-osd</code> will have insufficient permissions and it will revert to the slower WRITEAHEAD mode.</p>
<h4 id="note">Note</h4>
<p>Re: [<a href="https://github.com/Ulexus/docker-ceph/issues/5">https://github.com/Ulexus/docker-ceph/issues/5</a>]</p>
<p>A user has reported a consterning (and difficult to diagnose) problem wherein the OSD crashes frequently due to Docker running out of sufficient open file handles. This is understandable, as the OSDs use a great many ports during periods of high traffic. It is, therefore, recommended that you increase the number of open file handles available to Docker.</p>
<p>On CoreOS (and probably other systemd-based systems), you can do this by creating the a file named <code>/etc/systemd/system/docker.service.d/limits.conf</code> with content something like:</p>
<pre><code>[Service]
LimitNOFILE=4096
</code></pre>
<h2 id="deploy-a-mds">Deploy a MDS</h2>
<p>By default, the MDS does <em>NOT</em> create a ceph filesystem. If you wish to have this MDS create a ceph filesystem (it will only do this if the specified <code>CEPHFS_NAME</code> does not already exist), you <em>must</em> set, at a minimum, <code>CEPHFS_CREATE=1</code>. It is strongly recommended that you read the rest of this section, as well.</p>
<p>For most people, the defaults for the following optional environment variables are fine, but if you wish to customize the data and metadata pools in which your CephFS is stored, you may override the following as you wish:</p>
<ul>
<li><code>CEPHFS_CREATE</code>: Whether to create the ceph filesystem (0 = no / 1 = yes), if it doesn't exist. Defaults to 0 (no)</li>
<li><code>CEPHFS_NAME</code>: The name of the new ceph filesystem and the basis on which the later variables are created. Defaults to <code>cephfs</code></li>
<li><code>CEPHFS_DATA_POOL</code>: The name of the data pool for the ceph filesystem. If it does not exist, it will be created. Defaults to <code>${CEPHFS_NAME}_data</code></li>
<li><code>CEPHFS_DATA_POOL_PG</code>: The number of placement groups for the data pool. Defaults to <code>8</code></li>
<li><code>CEPHFS_METADATA_POOL</code>: The name of the metadata pool for the ceph filesystem. If it does not exist, it will be created. Defaults to <code>${CEPHFS_NAME}_metadata</code></li>
<li><code>CEPHFS_METADATA_POOL_PG</code>: The number of placement groups for the metadata pool. Defaults to <code>8</code></li>
</ul>
<p>Without KV backend, run:</p>
<pre><code>docker run -d --net=host \
-v /var/lib/ceph/:/var/lib/ceph/ \
-v /etc/ceph:/etc/ceph \
-e CEPHFS_CREATE=1 \
ceph/daemon mds
</code></pre>
<p>With KV backend, run:</p>
<pre><code>docker run -d --net=host \
-e CEPHFS_CREATE=1 \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
ceph/daemon mds
</code></pre>
<p>List of available options:</p>
<ul>
<li><code>MDS_NAME</code> is the name the MDS server (DEFAULT: mds-$(hostname)). One thing to note is that metadata servers are not machine-restricted. They are not bound by their data directories and can move around the cluster. As a result, you can run more than one MDS on a single machine. If you plan to do so, you better set this variable and do something like: <code>mds-$(hostname)-a</code>, <code>mds-$(hostname)-b</code>etc...</li>
</ul>
<h2 id="deploy-a-rados-gateway">Deploy a Rados Gateway</h2>
<p>For the Rados Gateway, we deploy it with <code>civetweb</code> enabled by default. However it is possible to use different CGI frontends by simply giving remote address and port.</p>
<p>Without kv backend, run:</p>
<pre><code>docker run -d --net=host \
-v /var/lib/ceph/:/var/lib/ceph/ \
-v /etc/ceph:/etc/ceph \
ceph/daemon rgw
</code></pre>
<p>With kv backend, run:</p>
<pre><code>docker run -d --net=host \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
ceph/daemon rgw
</code></pre>
<p>List of available options:</p>
<ul>
<li><code>RGW_CIVETWEB_PORT</code> is the port to which civetweb is listening on (DEFAULT: 8080)</li>
<li><code>RGW_NAME</code>: default to hostname</li>
</ul>
<p>Administration via <a href="https://docs.ceph.com/en/latest/man/8/radosgw-admin/">radosgw-admin</a> from the Docker host if the <code>RGW_NAME</code> variable hasn't been supplied:</p>
<p><code>docker exec &lt;containerId&gt; radosgw-admin -n client.rgw.$(hostname) -k /var/lib/ceph/radosgw/$(hostname)/keyring &lt;commands&gt;</code></p>
<p>If otherwise, <code>$(hostname)</code> has to be replaced by the value of <code>RGW_NAME</code>.</p>
<p>To enable an external CGI interface instead of civetweb set:</p>
<ul>
<li><code>RGW_REMOTE_CGI=1</code></li>
<li><code>RGW_REMOTE_CGI_HOST=192.168.0.1</code></li>
<li><code>RGW_REMOTE_CGI_PORT=9000</code></li>
</ul>
<p>And run the container like this <code>docker run -d -v /etc/ceph:/etc/ceph -v /var/lib/ceph/:/var/lib/ceph -e CEPH_DAEMON=RGW -e RGW_NAME=myrgw -p 9000:9000 -e RGW_REMOTE_CGI=1 -e RGW_REMOTE_CGI_HOST=192.168.0.1 -e RGW_REMOTE_CGI_PORT=9000 ceph/daemon</code></p>
<h2 id="deploy-a-rest-api">Deploy a REST API</h2>
<p>This is pretty straightforward. The <code>--net=host</code> is not mandatory, if you don't use it do not forget to expose the <code>RESTAPI_PORT</code>.
Only available in luminous.</p>
<pre><code>docker run -d --net=host \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
ceph/daemon restapi
</code></pre>
<p>List of available options:</p>
<ul>
<li><code>RESTAPI_IP</code> is the IP address to listen on (DEFAULT: 0.0.0.0)</li>
<li><code>RESTAPI_PORT</code> is the listening port of the REST API (DEFAULT: 5000)</li>
<li><code>RESTAPI_BASE_URL</code> is the base URL of the API (DEFAULT: /api/v0.1)</li>
<li><code>RESTAPI_LOG_LEVEL</code> is the log level of the API (DEFAULT: warning)</li>
<li><code>RESTAPI_LOG_FILE</code> is the location of the log file (DEFAULT: /var/log/ceph/ceph-restapi.log)</li>
</ul>
<h2 id="deploy-a-rbd-mirror">Deploy a RBD mirror</h2>
<p>This is pretty straightforward. The <code>--net=host</code> is not mandatory, with KV we do:</p>
<pre><code>docker run -d --net=host \
-e KV_TYPE=etcd \
-e KV_IP=192.168.0.20 \
ceph/daemon rbd_mirror
</code></pre>
<p>Without KV we do:</p>
<pre><code>docker run -d --net=host \
ceph/daemon rbd_mirror
</code></pre>
<h3 id="fetching-software">Fetching software.</h3>
<p>First of I want to check that I have all the latest packages in my debian system.</p>
<pre><code>apt update
apt upgrade
</code></pre>
<p>Next we fetch the keys and ceph packages, in this case we download the pacific packages for buster.</p>
<pre><code>wget -q -O- 'https://download.ceph.com/keys/release.asc' | sudo apt-key add -
echo deb https://download.ceph.com/debian-pacific/ buster main | sudo tee /etc/apt/sources.list.d/ceph.list
apt update
apt install ceph ceph-common
</code></pre>
<p>Last we need to download the smartmontools for our nodes. This is so we can monitor our hard drives for hardware issues.</p>
<pre><code>echo deb http://deb.debian.org/debian buster-backports main &gt;&gt; /etc/apt/sources.list
apt update
apt install smartmontools/buster-backports
</code></pre>
<p>A reboot when you have installed packages is always a good thing and if you need to do some extra hardware changes this is a good place to do so.</p>
<pre><code>shutdown -r now
</code></pre>
<h3 id="configure-node-1">Configure node 1</h3>
<p>First we will create a ceph configuration file.</p>
<pre><code>sudo vi /etc/ceph/ceph.conf
</code></pre>
<p>The most important things to specify is the id and ips of your cluster monitors. A unique cluster id that you will reuse for all your nodes. And lastly a public network range that you want your monitors to be available over. The cluster network is a good addition if you have the resources to route the recovery traffic on a backbone network.</p>
<pre><code>[global]
fsid = {cluster uuid}
mon initial members = {id1}, {id2}, {id2}
mon host = {ip1}, {ip2}, {ip3}
public network = {network range for your public network}
cluster network = {network range for your cluster network}
auth cluster required = cephx
auth service required = cephx
auth client required = cephx
</code></pre>
<p>Next we create keys for admin, monitors and boostrapping our drives. These keys will then be merged with the monitor key so the initial setup will have the keys used for other operations.</p>
<pre><code>sudo ceph-authtool --create-keyring /tmp/monkey --gen-key -n mon. --cap mon 'allow *'
sudo ceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --cap mon 'allow *' --cap osd 'allow *' --cap mds 'allow *' --cap mgr 'allow *'
sudo ceph-authtool --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring --gen-key -n client.bootstrap-osd --cap mon 'profile bootstrap-osd'
sudo ceph-authtool /tmp/monkey --import-keyring /etc/ceph/ceph.client.admin.keyring
sudo ceph-authtool /tmp/monkey --import-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring
</code></pre>
<p>Make the monitor key available to the ceph user so we don't get an permission error when we start our services.</p>
<pre><code>sudo chown ceph:ceph /tmp/monkey
</code></pre>
<p>Next up we create a monitor map so the monitors will know of each other. The monitors keeps track on other resources but for high availability the monitors needs to know who is in charge.</p>
<pre><code>monmaptool --create --add {node1-id} {node1-ip} --fsid {cluster uuid} /tmp/monmap
monmaptool --add {node2-id} {node2-ip} --fsid {cluster uuid} /tmp/monmap
monmaptool --add {node3-id} {node3-ip} --fsid {cluster uuid} /tmp/monmap
</code></pre>
<p>Starting a new monitor is as easy as creating a new directory, creating the filesystem for and starting the service.</p>
<pre><code>sudo -u ceph mkdir /var/lib/ceph/mon/ceph-{node1-id}
sudo -u ceph ceph-mon --mkfs -i {node1-id} --monmap /tmp/monmap --keyring /tmp/monkey
sudo systemctl start ceph-mon@{node1-id}
</code></pre>
<p>Next up we need a manager so we could configure and monitor our cluster through a visual dashboard. First we create a new key, put that key in a newly created directory and start the service. Enabling a dashboard is as easy as running the command for enabling, creating / assigning a certificate and creating a new admin user.</p>
<pre><code>sudo ceph auth get-or-create mgr.{node1-id} mon 'allow profile mgr' osd 'allow *' mds 'allow *'
sudo -u ceph mkdir /var/lib/ceph/mgr/ceph-{node1-id}
sudo -u ceph vi /var/lib/ceph/mgr/ceph-{node1-id}/keyring
sudo systemctl start ceph-mgr@{node1-id}
sudo ceph mgr module enable dashboard
sudo ceph dashboard create-self-signed-cert
sudo ceph dashboard ac-user-create admin -i passwd administrator
</code></pre>
<h3 id="setting-up-more-nodes">Setting up more nodes.</h3>
<p>First of we need to copy over the configuration, monitor map and all the keys over to our new host.</p>
<pre><code>sudo scp {user}@{server}:/etc/ceph/ceph.conf /etc/ceph/ceph.conf
sudo scp {user}@{server}:/etc/ceph/ceph.client.admin.keyring /etc/ceph/ceph.client.admin.keyring
sudo scp {user}@{server}:/var/lib/ceph/bootstrap-osd/ceph.keyring /var/lib/ceph/bootstrap-osd/ceph.keyring
sudo scp {user}@{server}:/tmp/monmap /tmp/monmap
sudo scp {user}@{server}:/tmp/monkey /tmp/monkey
</code></pre>
<p>Next up we setup the monitor node exactly as we did with the first node.</p>
<pre><code>sudo -u ceph mkdir /var/lib/ceph/mon/ceph-{node2-id}
sudo -u ceph ceph-mon --mkfs -i {node2-id} --monmap /tmp/monmap --keyring /tmp/monkey
sudo systemctl start ceph-mon@{node2-id}
sudo ceph -s
sudo ceph mon enable-msgr2
</code></pre>
<p>Then we setup the manager node exactly as we did with the first node.</p>
<pre><code>sudo ceph auth get-or-create mgr.{node2-id} mon 'allow profile mgr' osd 'allow *' mds 'allow *'
sudo -u ceph mkdir /var/lib/ceph/mgr/ceph-{node2-id}
sudo -u ceph vi /var/lib/ceph/mgr/ceph-{node2-id}/keyring
sudo systemctl start ceph-mgr@{node2-id}
</code></pre>
<h3 id="adding-storage">Adding storage</h3>
<p>When the cluster is up and running and all monitors are in qourum you could add storage services. This is easily done via the volume command. First prepare a disk so it will be known by the cluster and have the keys and configuration copied to the management directory. Next up you activate the service so your storage nodes will be ready to use. This will be done for all the harddrives you want to add to your network.</p>
<pre><code>sudo ceph-volume lvm prepare --data /dev/sdb 
sudo ceph-volume lvm activate {osd-number} {osd-uuid}
</code></pre>
<h3 id="post-configuration">Post configuration</h3>
<p>Last but not least you want to ensure that all the services starts after a reboot. In debian you do that by enabling the services.</p>
<pre><code>sudo systemctl enable ceph-mon@{node-id}
sudo systemctl enable ceph-mgr@{node-id}
sudo systemctl enable ceph-osd@{osd-number}
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 2025
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>